#!/bin/bash -exu

pgversion="postgres-9.4.6"
LOG_DIR=/var/vcap/sys/log/postgres
DATA_DIR="/var/vcap/store/${pgversion}"
RUN_DIR=/var/vcap/sys/run/postgres
JOB_DIR=/var/vcap/jobs/postgres
PACKAGE_DIR="/var/vcap/packages/${pgversion}"

function main() {
  mkdir -p "${LOG_DIR}"
  chown -R vcap:vcap "${LOG_DIR}"

  mkdir -p "${DATA_DIR}"
  chown -R vcap:vcap "${DATA_DIR}"

  mkdir -p "${RUN_DIR}"
  chown -R vcap:vcap "${RUN_DIR}"

  mkdir -p "${JOB_DIR}"
  chown -R vcap:vcap "${JOB_DIR}"

  mkdir -p "${PACKAGE_DIR}"
  chown -R vcap:vcap "${PACKAGE_DIR}"

  sysctl -w "kernel.shmmax=284934144"
}

main
